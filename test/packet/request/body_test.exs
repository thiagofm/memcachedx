defmodule Memcachedx.Packet.Request.BodyTest do
  use ExUnit.Case
  alias Memcachedx.Packet.Request.Body, as: Body
  doctest Body

  test 'merge_req set example' do
    options = [key: "Hello", value: "World", flags: 0xdeadbeef, expiry: 0x00000e10]
    assert Body.merge_req(options) == <<
      0xde, 0xad, 0xbe, 0xef,
      0x00, 0x00, 0x0e, 0x10,
      0x48, 0x65, 0x6c, 0x6c,
      0x6f, 0x57, 0x6f, 0x72,
      0x6c, 0x64
    >>
  end

  test 'merge_req get example' do
    options = [key: "Hello"]
    assert Body.merge_req(options) == <<
      0x48, 0x65, 0x6c, 0x6c,
      0x6f
    >>
  end

  test 'merge_req delete example' do
    options = [key: "Hello"]
    assert Body.merge_req(options) == <<
      0x48, 0x65, 0x6c, 0x6c,
      0x6f
    >>
  end

  test 'merge_req incr/decr example' do
    options = [delta: 0x0000000000000001, initial: 0x0000000000000000, expiration: 0x00000e10, key: "counter"]
    assert Body.merge_req(options) == <<
      0x00, 0x00, 0x00, 0x00,
      0x00, 0x00, 0x00, 0x01,
      0x00, 0x00, 0x00, 0x00,
      0x00, 0x00, 0x00, 0x00,
      0x00, 0x00, 0x0e, 0x10,
      0x63, 0x6f, 0x75, 0x6e,
      0x74, 0x65, 0x72
    >>
  end
end
